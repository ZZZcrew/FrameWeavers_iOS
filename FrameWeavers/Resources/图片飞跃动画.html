<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片飞跃动画 - 丝滑版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* 顶部堆叠区域 */
        .photo-stack {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 120px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .photo-stack h3 {
            position: absolute;
            top: -30px;
            left: 0;
            color: #333;
            font-size: 14px;
            font-weight: 500;
        }

        .stacked-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .stacked-image:hover {
            transform: scale(1.05);
        }

        /* 底部胶片区域 */
        .filmstrip {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 800px;
            height: 120px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .filmstrip h3 {
            position: absolute;
            top: -30px;
            left: 0;
            color: #333;
            font-size: 14px;
            font-weight: 500;
        }

        .filmstrip::-webkit-scrollbar {
            height: 6px;
        }

        .filmstrip::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .filmstrip::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        .filmstrip-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s ease;
            flex-shrink: 0;
        }

        .filmstrip-image:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        /* 飞跃动画的临时图片 */
        .flying-image {
            position: fixed;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            will-change: transform;
        }

        /* 优化的动画关键帧 */
        @keyframes flyToStack {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--end-x), var(--end-y)) scale(0.75) rotate(0deg);
                opacity: 0.8;
            }
        }

        .animate-fly {
            animation: flyToStack 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* 提示文字 */
        .hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: 18px;
            text-align: center;
            pointer-events: none;
        }

        /* 添加一个弧形路径的容器 */
        .arc-path {
            position: fixed;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>
    <!-- 顶部堆叠区域 -->
    <div class="photo-stack">
        <h3>照片堆叠区</h3>
        <div class="hint" id="stackHint">点击下方图片添加到这里</div>
    </div>

    <!-- 底部胶片区域 -->
    <div class="filmstrip">
        <h3>胶片视图</h3>
        <!-- 图片将通过JavaScript动态生成 -->
    </div>

    <script>
        // 图片数据
        const imageUrls = [
            'https://picsum.photos/seed/img1/200/200.jpg',
            'https://picsum.photos/seed/img2/200/200.jpg',
            'https://picsum.photos/seed/img3/200/200.jpg',
            'https://picsum.photos/seed/img4/200/200.jpg',
            'https://picsum.photos/seed/img5/200/200.jpg',
            'https://picsum.photos/seed/img6/200/200.jpg',
            'https://picsum.photos/seed/img7/200/200.jpg',
            'https://picsum.photos/seed/img8/200/200.jpg'
        ];

        // 初始化胶片视图
        const filmstrip = document.querySelector('.filmstrip');
        const photoStack = document.querySelector('.photo-stack');
        const stackHint = document.getElementById('stackHint');

        // 创建胶片图片
        imageUrls.forEach(url => {
            const img = document.createElement('img');
            img.src = url;
            img.className = 'filmstrip-image';
            img.addEventListener('click', handleImageClick);
            filmstrip.appendChild(img);
        });

        // 处理图片点击
        function handleImageClick(e) {
            const clickedImage = e.target;
            const rect = clickedImage.getBoundingClientRect();
            
            // 创建飞跃的图片
            const flyingImg = document.createElement('img');
            flyingImg.src = clickedImage.src;
            flyingImg.className = 'flying-image';
            flyingImg.style.left = rect.left + 'px';
            flyingImg.style.top = rect.top + 'px';
            document.body.appendChild(flyingImg);

            // 计算目标位置（堆叠区域中心）
            const stackRect = photoStack.getBoundingClientRect();
            const targetX = stackRect.left + stackRect.width / 2 - 40; // 40是图片宽度的一半
            const targetY = stackRect.top + stackRect.height / 2 - 40; // 40是图片高度的一半

            // 计算弧形路径的控制点
            const controlX = (rect.left + targetX) / 2;
            const controlY = Math.min(rect.top, targetY) - 150; // 向上偏移创建弧形

            // 使用requestAnimationFrame实现平滑弧形动画
            const startTime = performance.now();
            const duration = 400; // 动画持续时间（毫秒）

            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // 使用贝塞尔曲线计算进度
                const easeProgress = cubicBezier(progress, 0.25, 0.46, 0.45, 0.94);
                
                // 计算二次贝塞尔曲线上的点
                const x = (1 - easeProgress) * (1 - easeProgress) * rect.left + 
                         2 * (1 - easeProgress) * easeProgress * controlX + 
                         easeProgress * easeProgress * targetX;
                         
                const y = (1 - easeProgress) * (1 - easeProgress) * rect.top + 
                         2 * (1 - easeProgress) * easeProgress * controlY + 
                         easeProgress * easeProgress * targetY;
                
                // 计算缩放和旋转
                const scale = 1 - (0.25 * easeProgress);
                const rotation = Math.sin(easeProgress * Math.PI) * 15; // 正弦波旋转效果
                
                // 应用变换
                flyingImg.style.transform = `translate(${x - rect.left}px, ${y - rect.top}px) scale(${scale}) rotate(${rotation}deg)`;
                flyingImg.style.opacity = 1 - (0.2 * easeProgress);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // 动画结束，添加到堆叠区域
                    flyingImg.remove();
                    
                    const stackedImg = document.createElement('img');
                    stackedImg.src = clickedImage.src;
                    stackedImg.className = 'stacked-image';
                    photoStack.appendChild(stackedImg);
                    
                    // 隐藏提示文字
                    if (stackHint) {
                        stackHint.style.display = 'none';
                    }
                    
                    // 添加堆叠动画效果
                    stackedImg.style.transform = 'scale(0)';
                    setTimeout(() => {
                        stackedImg.style.transition = 'transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)';
                        stackedImg.style.transform = 'scale(1)';
                    }, 10);
                }
            }
            
            requestAnimationFrame(animate);
        }

        // 贝塞尔曲线计算函数
        function cubicBezier(t, p1, p2, p3, p4) {
            const cy = 3 * p2;
            const by = 3 * (p3 - p2) - cy;
            const ay = 1 - cy - by;
            const py = ay * t * t * t + by * t * t + cy * t;
            return py;
        }
    </script>
</body>
</html>